(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     25167,        609]
NotebookOptionsPosition[     24443,        582]
NotebookOutlinePosition[     24797,        598]
CellTagsIndexPosition[     24754,        595]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Needs", "[", "\"\<MATLink`\>\"", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.637354442533819*^9, 3.637354442536193*^9}, {
  3.638376113675886*^9, 3.6383761197461147`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Daily", " ", "Risk"}], "-", 
    RowBox[{"free", " ", "rate"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Rf", " ", "=", " ", 
    RowBox[{
     RowBox[{"Log", "[", "1.05", "]"}], "/", "365"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.6373526232919903`*^9, 3.637352641358612*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"x", "[", "y_Integer", "]"}], ":=", 
   RowBox[{"Function", "[", 
    RowBox[{"ticker", ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "dayNumbers", ",", "weekNumbers", ",", "dates", ",", "prices", ",", 
         "vol20Days", ",", "vol50Days", ",", "volume"}], "}"}], ",", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"dates", ",", "prices"}], "}"}], "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"FinancialData", "[", 
           RowBox[{"ticker", ",", "\"\<Price\>\"", ",", 
            RowBox[{"{", "y", "}"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vol20Days", "=", 
         RowBox[{"FinancialData", "[", 
          RowBox[{"ticker", ",", "\"\<Volatility20Day\>\"", ",", 
           RowBox[{"{", "y", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"vol50Days", "=", 
         RowBox[{"FinancialData", "[", 
          RowBox[{"ticker", ",", "\"\<Volatility50Day\>\"", ",", 
           RowBox[{"{", "y", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"volume", "=", 
         RowBox[{"Last", "@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"FinancialData", "[", 
            RowBox[{"ticker", ",", "\"\<Volume\>\"", ",", 
             RowBox[{"{", "y", "}"}]}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"dayNumbers", "=", 
         RowBox[{"dayNumber", "/@", "dates"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"weekNumbers", "=", 
         RowBox[{"weekNumberISO", "/@", "dates"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Check", " ", "if", " ", "vol", " ", "data", " ", "are", " ", "of", 
          " ", "correct", " ", "length"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"vol50Days", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "prices", "]"}], "\[NotEqual]", 
            RowBox[{"Length", "[", "vol50Days", "]"}]}], ",", 
           RowBox[{"Most", "@", "vol50Days"}], ",", "vol50Days"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"vol20Days", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "prices", "]"}], "\[NotEqual]", 
            RowBox[{"Length", "[", "vol20Days", "]"}]}], ",", 
           RowBox[{"Most", "@", "vol20Days"}], ",", "vol20Days"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Remove", " ", "last", " ", "element"}], ",", " ", 
          RowBox[{
          "there", " ", "shall", " ", "be", " ", "another", " ", "function", 
           " ", "to", " ", "return", " ", 
           RowBox[{"today", "'"}], "s", " ", "news"}]}], " ", "*)"}], " ", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Most", "@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
            "dayNumbers", ",", "weekNumbers", ",", "prices", ",", "vol20Days",
              ",", "vol50Days", ",", "volume"}], "}"}], "]"}]}], "//", 
         "N"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"r", "[", "y_Integer", "]"}], ":=", 
   RowBox[{"Function", "[", 
    RowBox[{"ticker", ",", "\[IndentingNewLine]", 
     RowBox[{"Last", "@", 
      RowBox[{"Transpose", "@", 
       RowBox[{"FinancialData", "[", 
        RowBox[{"ticker", ",", "\"\<Return\>\"", ",", 
         RowBox[{"{", "y", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.637278324407186*^9, 3.637278333143497*^9}, {
   3.637278364447509*^9, 3.637278371687311*^9}, {3.637278426681796*^9, 
   3.637278427504147*^9}, {3.63727852145175*^9, 3.637278847052188*^9}, {
   3.637278996636752*^9, 3.637279041832982*^9}, {3.637279215625557*^9, 
   3.637279265234088*^9}, 3.6372793003021393`*^9, {3.637281514397505*^9, 
   3.637281582573395*^9}, {3.6372822565754967`*^9, 3.637282256635898*^9}, {
   3.637353451213023*^9, 3.637353485078521*^9}, {3.637353595343758*^9, 
   3.6373536340360107`*^9}, {3.637354202222045*^9, 3.637354241921074*^9}, {
   3.637354514096134*^9, 3.637354529454775*^9}, {3.637354750103245*^9, 
   3.6373548003535013`*^9}, {3.6373548373557367`*^9, 
   3.6373548890926933`*^9}, {3.637355074361277*^9, 3.637355078377404*^9}, {
   3.637355461632481*^9, 3.637355485902697*^9}, {3.637357224164147*^9, 
   3.637357243581153*^9}, {3.637799454339313*^9, 3.6377995070242367`*^9}, {
   3.637800386648649*^9, 3.637800387348172*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"weekNumberISO", "[", "date_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"day0", ",", "year"}], "}"}], ",", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"days", "=", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Mon\>\"", ",", "\"\<Tue\>\"", ",", "\"\<Wed\>\"", ",", 
          "\"\<Thu\>\"", ",", "\"\<Fri\>\"", ",", "\"\<Sat\>\"", ",", 
          "\"\<Sun\>\""}], "}"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"year", "=", 
        RowBox[{"ToExpression", "[", 
         RowBox[{"DateString", "[", 
          RowBox[{"date", ",", "\"\<Year\>\""}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"day0", "=", 
        RowBox[{"DatePlus", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"year", ",", "1", ",", "4"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "-", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"days", ",", 
                RowBox[{"DateString", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"year", ",", "1", ",", "4"}], "}"}], ",", 
                  "\"\<DayNameShort\>\""}], "]"}]}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", "\"\<Day\>\""}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"1", "+", 
        RowBox[{"Floor", "[", 
         RowBox[{
          RowBox[{"DateDifference", "[", 
           RowBox[{"day0", ",", "date", ",", "\"\<Week\>\""}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.637280878402464*^9, 3.637280878404545*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"dayNumber", "[", "date_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DateString", "[", 
    RowBox[{"date", ",", "\"\<DayName\>\""}], "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Monday\>\"", "\[Rule]", "1"}], ",", 
     RowBox[{"\"\<Tuesday\>\"", "\[Rule]", "2"}], ",", 
     RowBox[{"\"\<Wednesday\>\"", "\[Rule]", "3"}], ",", 
     RowBox[{"\"\<Thursday\>\"", "\[Rule]", "4"}], ",", 
     RowBox[{"\"\<Friday\>\"", "\[Rule]", "5"}], ",", 
     RowBox[{"\"\<Saturday\>\"", "\[Rule]", "6"}], ",", 
     RowBox[{"\"\<Sunday\>\"", "\[Rule]", "7"}]}], "}"}]}]}]], "Input",
 CellChangeTimes->{{3.6372814258148108`*^9, 3.637281448351781*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Utility", " ", "function", " ", "given", " ", "a", " ", "return", " ", 
    "rate"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"U", "[", "r_", "]"}], ":=", 
    RowBox[{"Min", "[", 
     RowBox[{
      RowBox[{"2", 
       RowBox[{"(", 
        RowBox[{"r", "-", "Rf"}], ")"}]}], ",", 
      RowBox[{"(", 
       RowBox[{"r", "-", "Rf"}], ")"}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.6372858158390417`*^9, 3.637285833104273*^9}, {
  3.6372859745891743`*^9, 3.6372859920629797`*^9}, {3.6372863609429293`*^9, 
  3.637286391602461*^9}, {3.637286524399839*^9, 3.637286524580285*^9}, {
  3.6373526481788473`*^9, 3.6373526518327713`*^9}, {3.6373527938637466`*^9, 
  3.6373528101040688`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "return", " ", "on", " ", "a", " ", "stock", " ", "given", " ", "q", " ", 
     "and", " ", "its", " ", "next"}], "-", 
    RowBox[{"day", " ", "return"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"p", "[", 
     RowBox[{"x_List", ",", "r_Real"}], "]"}], ":=", 
    RowBox[{"Function", "[", 
     RowBox[{"q", ",", 
      RowBox[{
       RowBox[{"r", " ", 
        RowBox[{"q", ".", "x"}]}], "+", 
       RowBox[{"Rf", 
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"q", ".", "x"}]}], ")"}]}]}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.637352542861945*^9, 3.637352596770791*^9}, {
  3.637352671350371*^9, 3.6373527318570013`*^9}, {3.637352806359825*^9, 
  3.637352870591525*^9}, {3.637353087932302*^9, 3.637353088460475*^9}, {
  3.63735407171563*^9, 3.6373540834023943`*^9}, {3.637358825372855*^9, 
  3.637358826091959*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Average", " ", "utility", " ", "with", " ", "respect", " ", "to", " ", 
    "q", " ", "from", " ", "date", " ", "y"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"objective", "[", 
     RowBox[{"stocks_List", ",", "y_Integer"}], "]"}], ":=", 
    RowBox[{"Function", "[", 
     RowBox[{"q", ",", "\[IndentingNewLine]", 
      RowBox[{"With", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"allFeatures", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"x", "[", "y", "]"}], "/@", "stocks"}], ",", "1"}], 
            "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"allReturns", "=", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"r", "[", "y", "]"}], "/@", "stocks"}], ",", "1"}], 
            "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Total", "[", 
         RowBox[{"U", "/@", 
          RowBox[{"Through", "[", 
           RowBox[{
            RowBox[{"MapThread", "[", 
             RowBox[{"p", ",", 
              RowBox[{"{", 
               RowBox[{"allFeatures", ",", "allReturns"}], "}"}]}], "]"}], 
            "[", "q", "]"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}],
      "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.637353028715088*^9, 3.637353035763673*^9}, {
  3.637353204897333*^9, 3.637353292764289*^9}, {3.6373533774113197`*^9, 
  3.637353386395473*^9}, {3.637353881932197*^9, 3.637353883892741*^9}, {
  3.637354006640139*^9, 3.63735405480562*^9}, {3.637354125463132*^9, 
  3.6373541558068533`*^9}, {3.637355012135242*^9, 3.637355043954466*^9}, {
  3.63735508677842*^9, 3.637355092794897*^9}, {3.637355647394771*^9, 
  3.637355649875637*^9}, {3.637356671362501*^9, 3.637356690593233*^9}, {
  3.6373570742862473`*^9, 3.637357173517803*^9}, {3.637357258917201*^9, 
  3.6373572654419107`*^9}, {3.637357491374017*^9, 3.637357493166731*^9}, {
  3.637357657795133*^9, 3.6373576817443113`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"solveObjective", "[", 
   RowBox[{"stocks_List", ",", "y_Integer"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Call", " ", "to", " ", "Data"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"xs", "=", 
       RowBox[{"adjustFeaturesMatrix", "[", 
        RowBox[{
         RowBox[{"x", "[", "y", "]"}], "/@", "stocks"}], "]"}]}], ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Matrix", " ", "of", " ", "features", " ", "of", " ", "the", " ", 
        RowBox[{"form", " ", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"x11", "^", "T"}], ";", 
            RowBox[{"x12", "^", "T"}], ";", 
            RowBox[{"x13", "^", "T"}], ";"}], "..."}], ";", 
          RowBox[{"xNN", "^", "T"}]}], "]"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"rs", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"r", "[", "y", "]"}], "/@", "stocks"}], ",", "1"}], "]"}]}],
       ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Vector", " ", "of", " ", "returns"}], " ", "*)"}], 
      "\[IndentingNewLine]", "p", ",", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"Number", " ", "of", " ", "features"}], " ", "*)"}], 
      "\[IndentingNewLine]", "n"}], " ", 
     RowBox[{"(*", " ", 
      RowBox[{"Number", " ", "of", " ", "datapoints", " ", 
       RowBox[{"(", 
        RowBox[{"days", " ", "\[Times]", " ", "stocks"}], ")"}]}], " ", 
      "*)"}], "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Constants", " ", "initialization"}], " ", "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", "TEMP", " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"xs", "=", 
       RowBox[{"Take", "[", 
        RowBox[{"xs", ",", "5"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"rs", "=", 
       RowBox[{"Take", "[", 
        RowBox[{"rs", ",", "5"}], "]"}]}], ";"}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", "p"}], "}"}], "=", 
      RowBox[{"Dimensions", "[", "xs", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"With", "\[IndentingNewLine]", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"q", "=", 
         RowBox[{"rangeVars", "[", 
          RowBox[{"q", ",", "p"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"NMaximize", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"rs", "-", "1"}], ")"}], "*", 
                RowBox[{"(", 
                 RowBox[{"xs", ".", "q"}], ")"}]}], ",", "0"}], "]"}], "-", 
             RowBox[{"2", 
              RowBox[{"Max", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", "rs"}], ")"}], "*", 
                 RowBox[{"(", 
                  RowBox[{"xs", ".", "q"}], ")"}]}], ",", "0"}], "]"}]}]}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Norm", "[", "q", "]"}], "\[LessEqual]", "1"}]}], "}"}], 
         ",", "\[IndentingNewLine]", "q"}], "\[IndentingNewLine]", "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{"With", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Mu]s", "=", 
         RowBox[{"rangeVars", "[", 
          RowBox[{"\[Mu]", ",", "n"}], "]"}]}], ",", 
        RowBox[{"\[Lambda]s", "=", 
         RowBox[{"rangeVars", "[", 
          RowBox[{"\[Lambda]", ",", "n"}], "]"}]}], ",", 
        RowBox[{"qs", "=", 
         RowBox[{"rangeVars", "[", 
          RowBox[{"q", ",", "p"}], "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"NMaximize", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", "Objective", " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Mu]s", ".", 
            RowBox[{"ones", "[", "n", "]"}]}], "-", 
           RowBox[{"2", 
            RowBox[{"\[Lambda]s", ".", 
             RowBox[{"ones", "[", "n", "]"}]}]}]}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", "Constraints", " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\[Lambda]", ",", "r", ",", "x"}], "}"}], ",", 
               RowBox[{"\[Lambda]", "\[GreaterEqual]", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"r", "-", "1"}], ")"}], 
                 RowBox[{"qs", ".", "x"}]}]}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[Lambda]s", ",", "rs", ",", "xs"}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", "~", "Join", "~", "\[IndentingNewLine]", 
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{"Function", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\[Mu]", ",", "r", ",", "x"}], "}"}], ",", 
               RowBox[{"\[Mu]", "\[GreaterEqual]", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", "r"}], ")"}], 
                 RowBox[{"qs", ".", "x"}]}]}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"\[Mu]s", ",", "rs", ",", "xs"}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", "~", "Join", "~", "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"GreaterEqual", "[", 
             RowBox[{
              RowBox[{"\[Mu]s", "~", "Join", "~", "\[Lambda]s"}], ",", "0"}], 
             "]"}], "]"}], "\[IndentingNewLine]", "~", "Join", "~", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Norm", "[", "qs", "]"}], "\[LessEqual]", "1"}], 
            "}"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"For", " ", "following", " ", "vars"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#", ",", "0"}], "}"}], "&"}], "[", 
            RowBox[{
            "\[Mu]s", "~", "Join", "~", "\[Lambda]s", "~", "Join", "~", 
             "qs"}], "]"}], "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
        "\[Mu]s", "~", "Join", "~", "\[Lambda]s", "~", "Join", "~", "qs"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"MaxIterations", "\[Rule]", "200"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}], "*)"}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.637433543962352*^9, 3.637433618268734*^9}, {
   3.637433784789402*^9, 3.6374338681991796`*^9}, {3.6374340496495237`*^9, 
   3.637434114386417*^9}, {3.637434196720015*^9, 3.63743421679729*^9}, {
   3.637435898854578*^9, 3.63743593017124*^9}, {3.637435960717751*^9, 
   3.637435977024015*^9}, {3.637436099141057*^9, 3.637436145106986*^9}, {
   3.637436176577359*^9, 3.637436185497452*^9}, {3.63743627477104*^9, 
   3.637436307252296*^9}, {3.637436345725025*^9, 3.637436735723419*^9}, {
   3.63743690793891*^9, 3.637436908210205*^9}, 3.637448174599373*^9, {
   3.637530871674211*^9, 3.637530878771762*^9}, {3.63753517982446*^9, 
   3.637535208806211*^9}, {3.6375355262213287`*^9, 3.63753557286379*^9}, {
   3.637535655403945*^9, 3.637535659643635*^9}, {3.637535785341851*^9, 
   3.6375358089533567`*^9}, 3.6377668421248817`*^9, {3.63776698748386*^9, 
   3.637766990754651*^9}, {3.637767463900136*^9, 3.637767488579896*^9}, 
   3.6377738742032337`*^9, 3.637773907528207*^9, 3.6377822148288507`*^9, {
   3.637782265280479*^9, 3.6377822901728573`*^9}, 3.6377826942405243`*^9, {
   3.637782797177659*^9, 3.6377828043206882`*^9}, 3.6377828413689613`*^9, {
   3.637783072516371*^9, 3.637783076371587*^9}, 3.637783122715187*^9, {
   3.637783617272441*^9, 3.637783621126233*^9}, 3.6377836546666603`*^9, {
   3.637785085214738*^9, 3.637785089625492*^9}, {3.637800425421752*^9, 
   3.637800432501172*^9}, {3.638217642802312*^9, 3.6382176463539457`*^9}, {
   3.638278546174609*^9, 3.6382785465281677`*^9}, {3.638285120693712*^9, 
   3.638285158657668*^9}, {3.6382857965529833`*^9, 3.638285814109027*^9}, {
   3.638286160966704*^9, 3.638286163540659*^9}, {3.638289247994294*^9, 
   3.638289361213889*^9}, {3.638312583905151*^9, 3.6383126147149067`*^9}, 
   3.6383128473383293`*^9, {3.6383129094505997`*^9, 3.6383129451287537`*^9}, {
   3.63831338587127*^9, 3.638313439775526*^9}, {3.6383134765567417`*^9, 
   3.63831352405534*^9}, {3.638314175893118*^9, 3.638314197442114*^9}, {
   3.638316619765337*^9, 3.638316621340906*^9}, {3.638351168719152*^9, 
   3.638351173426458*^9}, {3.638366772529181*^9, 3.6383667943280478`*^9}, 
   3.638366834164937*^9, {3.638371736679616*^9, 3.638371747285128*^9}, {
   3.638374117873307*^9, 3.6383741675801163`*^9}, {3.638374200136364*^9, 
   3.6383742610471983`*^9}, {3.638374704253037*^9, 3.6383747046745462`*^9}, {
   3.638375220540291*^9, 3.638375220858675*^9}, {3.638375375418767*^9, 
   3.638375375487928*^9}, {3.6384630100065813`*^9, 3.638463046676312*^9}, {
   3.6384630835907383`*^9, 3.6384631104299097`*^9}, {3.6384631426663446`*^9, 
   3.638463222908802*^9}, {3.638463259486126*^9, 3.638463330375435*^9}, 
   3.638463403862336*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"adjustFeaturesMatrix", "[", "xs_List", "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "newXs", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"newXs", "=", 
       RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"xStock", ",", "\[IndentingNewLine]", 
             RowBox[{"Transpose", "@", 
              RowBox[{"MapThread", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Standardize", "[", 
                  RowBox[{
                   RowBox[{"{", "##", "}"}], ",", "Mean", ",", 
                   RowBox[{"Function", "[", 
                    RowBox[{"3", 
                    RowBox[{"StandardDeviation", "[", "##", "]"}]}], "]"}]}], 
                  "]"}], "&"}], ",", "xStock"}], "]"}]}]}], "]"}], ",", 
           "\[IndentingNewLine]", "xs"}], "]"}], ",", "\[IndentingNewLine]", 
         "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ArrayFlatten", "[", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"1", ",", "newXs"}], "}"}], "}"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.637800438920693*^9, 3.637800491287294*^9}, {
  3.637804352630316*^9, 3.637804356896595*^9}, {3.6378049110389147`*^9, 
  3.6378049758175983`*^9}, {3.6382853770797243`*^9, 3.638285409693372*^9}, {
  3.638285466286581*^9, 3.638285494890761*^9}}],

Cell[CellGroupData[{

Cell[BoxData["FindMaximum"], "Input",
 CellChangeTimes->{{3.6383142237462254`*^9, 3.638314224966402*^9}}],

Cell[BoxData["FindMaximum"], "Output",
 CellChangeTimes->{3.6383657913980837`*^9}]
}, Open  ]]
},
WindowSize->{884, 1055},
WindowMargins->{{Automatic, 34}, {Automatic, 0}},
FrontEndVersion->"10.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (June 27, \
2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 308, 7, 46, "Input"],
Cell[869, 29, 373, 10, 46, "Input"],
Cell[1245, 41, 4899, 103, 403, "Input"],
Cell[6147, 146, 1813, 48, 114, "Input"],
Cell[7963, 196, 707, 15, 63, "Input"],
Cell[8673, 213, 792, 20, 46, "Input"],
Cell[9468, 235, 966, 25, 46, "Input"],
Cell[10437, 262, 2139, 48, 148, "Input"],
Cell[12579, 312, 10050, 220, 879, "Input"],
Cell[22632, 534, 1580, 37, 165, "Input"],
Cell[CellGroupData[{
Cell[24237, 575, 105, 1, 28, "Input"],
Cell[24345, 578, 82, 1, 28, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
